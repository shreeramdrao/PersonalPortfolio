document.addEventListener("DOMContentLoaded", function () {
    // Typing Effect
    const textElement = document.querySelector(".typing-effect");
    const words = ["AI Engineer", "ML Engineer", "Generative AI Developer"];
    let wordIndex = 0;
    let letterIndex = 0;
    let isDeleting = false;
    let typingSpeed = 100;
    let deletingSpeed = 50;
    let delayAfterWord = 1000; // Delay after typing a word

    function type() {
        let currentWord = words[wordIndex];
        let currentText = isDeleting 
            ? currentWord.substring(0, letterIndex - 1) 
            : currentWord.substring(0, letterIndex + 1);

        textElement.innerHTML = currentText + `<span class="cursor">|</span>`; // Blinking Cursor

        if (!isDeleting && letterIndex === currentWord.length) {
            setTimeout(() => isDeleting = true, delayAfterWord);
        } else if (isDeleting && letterIndex === 0) {
            isDeleting = false;
            wordIndex = (wordIndex + 1) % words.length;
        }

        letterIndex += isDeleting ? -1 : 1;
        setTimeout(type, isDeleting ? deletingSpeed : typingSpeed);
    }
    type();
    
    // Mobile Navigation Menu Toggle
    const menuToggle = document.getElementById('menuToggle');
    const navMenu = document.getElementById('navMenu');
    
    if (menuToggle) {
        menuToggle.addEventListener('click', function() {
            navMenu.classList.toggle('active');
        });
    }
    
    // Close mobile menu when clicking on a nav link
    const navLinks = document.querySelectorAll('#navMenu a');
    navLinks.forEach(link => {
        link.addEventListener('click', function() {
            navMenu.classList.remove('active');
        });
    });
    
    // Smooth scrolling for navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            if (this.getAttribute('href') !== '#') {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 70, // Offset for fixed header
                        behavior: 'smooth'
                    });
                }
            }
        });
    });
    
    // Scroll to top button
    const scrollTopBtn = document.createElement('button');
    scrollTopBtn.innerHTML = '<i class="fas fa-arrow-up"></i>';
    scrollTopBtn.className = 'scroll-top-btn';
    document.body.appendChild(scrollTopBtn);
    
    // Show/hide scroll to top button based on scroll position
    window.addEventListener('scroll', function() {
        if (window.pageYOffset > 300) {
            scrollTopBtn.classList.add('show');
        } else {
            scrollTopBtn.classList.remove('show');
        }
    });
    
    // Scroll to top when button is clicked
    scrollTopBtn.addEventListener('click', function() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });
    
    // Add animation to elements when they come into view
    const animateOnScroll = function() {
        const sections = document.querySelectorAll('section');
        const elements = document.querySelectorAll('.skill, .timeline-item, .certification-card');
        
        sections.forEach(section => {
            const sectionPosition = section.getBoundingClientRect().top;
            const windowHeight = window.innerHeight;
            
            if (sectionPosition < windowHeight - 50) {
                section.classList.add('visible');
            }
        });
        
        elements.forEach(element => {
            const elementPosition = element.getBoundingClientRect().top;
            const windowHeight = window.innerHeight;
            
            if (elementPosition < windowHeight - 50) {
                element.classList.add('animate');
            }
        });
    };
    
    // Run animation check on scroll
    window.addEventListener('scroll', animateOnScroll);
    // Run once on page load
    animateOnScroll();
});  // End of DOMContentLoaded event listener

// Open Modal Function
function openModal(certId) {
    document.getElementById(certId).style.display = "flex";
    document.body.style.overflow = "hidden"; // Prevent scrolling when modal is open
}

// Close Modal Function
function closeModal(certId) {
    document.getElementById(certId).style.display = "none";
    document.body.style.overflow = "auto"; // Restore scrolling
}

// Close Modal on Click Outside
window.onclick = function(event) {
    let modals = document.querySelectorAll(".modal");
    modals.forEach(modal => {
        if (event.target === modal) {
            modal.style.display = "none";
            document.body.style.overflow = "auto"; // Restore scrolling
        }
    });
};

// Close Modal on Escape Key
document.addEventListener("keydown", function(event) {
    if (event.key === "Escape") {
        let modals = document.querySelectorAll(".modal");
        modals.forEach(modal => {
            modal.style.display = "none";
            document.body.style.overflow = "auto"; // Restore scrolling
        });
    }
});

// Initialize EmailJS
document.addEventListener('DOMContentLoaded', function() {
    emailjs.init('y8WhK2Rd-3m-NQO8s'); // Replace with your EmailJS public key

    const contactForm = document.getElementById('contactForm');
    
    if (contactForm) {
        contactForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form values
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const message = document.getElementById('message').value;
            
            // Simple validation
            if (name && email && message) {
                // Show loading state
                const submitBtn = contactForm.querySelector('button[type="submit"]');
                const originalBtnText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
                submitBtn.disabled = true;

                // Send email using EmailJS
                emailjs.send('service_jox3k0d', 'template_muis5vr', { // Replace with your service and template IDs
                    to_email: 'shreeramds3462@gmail.com',
                    from_name: name,
                    from_email: email,
                    message: message
                }).then(function() {
                    // Create success message
                    const successMessage = document.createElement('div');
                    successMessage.className = 'form-success';
                    successMessage.innerHTML = `<i class="fas fa-check-circle"></i> Thanks ${name}! Your message has been sent successfully.`;
                    
                    // Replace form with success message
                    contactForm.innerHTML = '';
                    contactForm.appendChild(successMessage);
                    
                    // Reset form after 5 seconds
                    setTimeout(() => {
                        contactForm.innerHTML = `
                            <div class="form-group">
                                <input type="text" id="name" placeholder="Your Name" required>
                            </div>
                            <div class="form-group">
                                <input type="email" id="email" placeholder="Your Email" required>
                            </div>
                            <div class="form-group">
                                <textarea id="message" placeholder="Your Message" required></textarea>
                            </div>
                            <button type="submit" class="submit-btn">Send Message</button>
                        `;
                    }, 5000);
                }).catch(function(error) {
                    // Handle error
                    const errorMessage = document.createElement('div');
                    errorMessage.className = 'form-error';
                    errorMessage.innerHTML = `<i class="fas fa-exclamation-circle"></i> Sorry, there was an error sending your message. Please try again.`;
                    contactForm.insertBefore(errorMessage, contactForm.firstChild);
                    
                    // Reset button state
                    submitBtn.innerHTML = originalBtnText;
                    submitBtn.disabled = false;
                });
            }
        });
    }
});